---
title: "Lab 3"
author: "Peter Gansallo"
date: "2024-12-9"
---

Install the necessary libraries

```{r}
#| echo: true
#| output: false
#| warning: false

# Install gssr package to retrieve gssr data
install.packages('gssr', repos =
  c('https://kjhealy.r-universe.dev', 'https://cloud.r-project.org'))

# Install 'gssrdoc' for gss documentation
install.packages('gssrdoc', repos =
  c('https://kjhealy.r-universe.dev', 'https://cloud.r-project.org'))
```

Load the necessary libraries and set path

```{r}
library(gssr)
library(tidyverse) # collection of R packages designed for data science
library(here) # helps with filepaths
library(dplyr)

#Set Path and ensure working in the correct path
setwd("~/Desktop/RWork")
here::i_am("lab3final.Rmd")
```

Load GSS data set 

```{r}
#| echo: true
#| output: true
#| warning: false
# load the master documentation files
data(gss_all) # note that this is a large file of all GSS data
data(gssrdoc) # this is the documentation for the GSS data
```


## Report 1.1
I've decided to use the General Social Survey Dataset (GSS)

## Report 1.2
I'll be analyzing two variables, how foreign the respondent, called foreign_level, and the second variable is the highest level of education the respondent obtained

## Report 1.3
Does how foreign one is influence their educational attainment?


Look on https://gssdataexplorer.norc.org/variables/vfilter for variables of interest

After looking at GSS data explorer I decided to use these variables:
- maborn: Whether respondents mother was born in the US
- paborn: Whether respondents mother was born in the US
- born : Whether the respondent was born in the US
- granborn: How many of the respondents grandparents were born in the US
- degree: Highest level degree the respondent has

```{r}
# double check the data is available for 2022
gss_all %>%
  gss_which_years(c(paborn, maborn, born,granborn, degree, age, educ)) %>%
  print(n = Inf)
```

Select the year for 2022

```{r}
#| echo: true
#| output: true
#| warning: false

gss22 <- gss_get_yr(2022)
```

Select the variables of interest in the data set

```{r}
#| echo: true
#| output: true
#| warning: false

# select your variables for a single year using cross sectional file
df22 <- gss22 %>% 
  select(paborn, maborn, born,granborn, degree, age, educ)
```

Check if the amount of missing data in the data set

```{r}
sapply(df22, function(x) sum(is.na(x)))
```

Check the dimensions of the data

```{r}
dim(df22)
```

There are about 4150 observations, and about 900 values that are NA
I'm now going to remove the NA values and filter age to only be 25 and up

```{r}
df22_nonull <- df22 %>%
  filter(age >= 25) %>%
  drop_na()
```

Check the updated dimensions

```{r}
dim(df22_nonull)
```

We've now removed about a 900 values from the dataset, about 20-25%
#### Create categories for if parents are native, mixed, or foreign

Create a new column on the condition that parent is foreign
Parent being foreign means the value == 2
column condition from 
https://www.geeksforgeeks.org/adding-new-column-with-conditional-values-using-ifelse-in-r/

```{r}

# Adding a new columns with multiple conditions
df22_nonull$dad_foreign <- ifelse(df22_nonull$paborn == 2, 1, 0)
df22_nonull$mom_foreign <- ifelse(df22_nonull$maborn == 2, 1, 0)

#Potentially create lm
df22_nonull$num_parent_foreign <- df22_nonull$mom_foreign + df22_nonull$dad_foreign

#Categories for for foreign level
df22_nonull$foreign_level <- ifelse(df22_nonull$num_parent_foreign == 2, "Foreign",
                            ifelse(df22_nonull$num_parent_foreign == 1, "Mixed", "None"))
                            
df22_nonull$foreign_level <- as.factor(df22_nonull$foreign_level)

```

Quick look at the structure of the data again

```{r}
str(df22_nonull)
```

Only keep variables of interest and divide into two looks for further analysis,
native born people, and non-native born 

```{r}
main_analysis <- df22_nonull %>%
  select(born, degree, foreign_level, num_parent_foreign, granborn,educ)

native_df <- df22_nonull %>%
  filter(born == 1) %>%
  select(born, degree, foreign_level, num_parent_foreign, granborn,educ)

non_native_df <- df22_nonull %>%
  filter(born == 2) %>%
  select(born, degree, foreign_level, num_parent_foreign, granborn,educ)
```

```{r}
table(main_analysis$educ)
```



```{r}
hist(main_analysis$degree)
```


Crosstab and see percentages of nativity and degree attainment

```{r}
library(Hmisc)
library(descr)

## add row percentages to the cross tab
crosstab(main_analysis$born, main_analysis$degree,
         prop.r=T) # add row percentages

```


Create Visual for foreign born individual and how foreign there parents are

```{r}
barplot(table(non_native_df$foreign_level),
        main = "Forerign born parents",
        col = c("yellow","blue","green"),
        xlab = "Parent Foreignnes",
        ylab = "Frequency")
```

Create Visuals for native born individuals and ratios of how foreign there parents are

```{r}
barplot(table(native_df$foreign_level),
        main = "Forerign born parents",
        col = c("yellow","blue","green"),
        xlab = "Parent Foreignnes",
        ylab = "Frequency")
```





